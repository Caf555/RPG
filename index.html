<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>å„²å­˜åº«æª”æ¡ˆç€è¦½å™¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            color: #24292e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e1e4e8;
        }
        #repo-name {
            color: #0366d6;
        }
        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            padding: 25px;
            margin-bottom: 20px;
        }
        .file-list {
            list-style-type: none;
        }
        .file-item {
            padding: 10px 15px;
            border-bottom: 1px solid #e1e4e8;
            display: flex;
            align-items: center;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-item:hover {
            background-color: #f6f8fa;
        }
        .file-icon {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        .file-link {
            flex-grow: 1;
            text-decoration: none;
            color: #0366d6;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .file-link:hover {
            text-decoration: underline;
        }
        .file-meta {
            color: #586069;
            font-size: 0.85em;
        }
        .loader {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #586069;
        }
        .error {
            color: #cb2431;
            padding: 15px;
            background-color: #ffeef0;
            border-radius: 4px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 15px;
            color: #0366d6;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        footer {
            margin-top: 30px;
            text-align: center;
            color: #586069;
            font-size: 0.9em;
        }
        @media (max-width: 768px) {
            .file-meta {
                display: none;
            }
        }
        #search {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æª”æ¡ˆç€è¦½å™¨ - <span id="repo-name">æ­£åœ¨è¼‰å…¥...</span></h1>
        <input type="text" id="search" placeholder="æœå°‹æª”æ¡ˆ..." aria-label="æœå°‹æª”æ¡ˆ">
        <div id="file-container">
            <div class="loader">æ­£åœ¨è¼‰å…¥æª”æ¡ˆåˆ—è¡¨...</div>
        </div>
    </div>

    <footer>
        è‡ªå‹•ç”¢ç”Ÿçš„å„²å­˜åº«æª”æ¡ˆç€è¦½å™¨ | é©ç”¨æ–¼è˜‹æœè£ç½®
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è§£æç•¶å‰URLä»¥ç²å–ä½¿ç”¨è€…åå’Œå„²å­˜åº«å
            function getRepoInfo() {
                const url = window.location.href;
                const match = url.match(/https?:\/\/([^.]+)\.github\.io\/([^\/]+)/);
                
                if (match && match.length >= 3) {
                    return {
                        username: match[1],
                        repo: match[2]
                    };
                }
                
                // å¦‚æœç„¡æ³•å¾GitHub Pages URLç²å–ï¼Œå˜—è©¦å¾åŸå§‹URLç²å–
                const pathParts = window.location.pathname.split('/');
                if (pathParts.length >= 2) {
                    return {
                        username: 'current-user', // ç„¡æ³•å¯é åœ°å¾ç›´æ¥æª”æ¡ˆç²å–
                        repo: pathParts[1] === '' ? 'ç•¶å‰å„²å­˜åº«' : pathParts[1]
                    };
                }
                
                return {
                    username: 'unknown',
                    repo: 'ç•¶å‰å„²å­˜åº«'
                };
            }
            
            // è¨­ç½®å„²å­˜åº«åç¨±
            const repoInfo = getRepoInfo();
            document.getElementById('repo-name').textContent = repoInfo.repo;
            
            // ç²å–GitHubå„²å­˜åº«å…§å®¹
            async function fetchRepoContents() {
                const fileContainer = document.getElementById('file-container');
                
                try {
                    // å¦‚æœæ˜¯å¾æœ¬åœ°æª”æ¡ˆç³»çµ±é–‹å•Ÿï¼Œä½¿ç”¨fetch APIå¯èƒ½æœƒæœ‰è·¨åŸŸå•é¡Œ
                    // å°‡ä½¿ç”¨éœæ…‹é¡¯ç¤ºç›®å‰ç›®éŒ„å…§å®¹
                    const isLocalFile = window.location.protocol === 'file:';
                    
                    if (isLocalFile) {
                        displayLocalFileWarning();
                        return;
                    }
                    
                    // æª¢æŸ¥æˆ‘å€‘æ˜¯å¦åœ¨GitHub Pagesä¸Š
                    const url = `https://api.github.com/repos/${repoInfo.username}/${repoInfo.repo}/contents`;
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        throw new Error(`GitHub API å›æ‡‰éŒ¯èª¤: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    displayFiles(data);
                } catch (error) {
                    // å¦‚æœAPIèª¿ç”¨å¤±æ•—ï¼Œä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ
                    console.error('ç„¡æ³•ç²å–å„²å­˜åº«å…§å®¹:', error);
                    displayAlternative();
                }
            }
            
            // é¡¯ç¤ºæª”æ¡ˆåˆ—è¡¨
            function displayFiles(files) {
                const fileContainer = document.getElementById('file-container');
                
                // éæ¿¾æ‰index.htmlï¼ˆç•¶å‰æª”æ¡ˆï¼‰
                files = files.filter(file => file.name.toLowerCase() !== 'index.html');
                
                if (files.length === 0) {
                    fileContainer.innerHTML = '<p>æ­¤å„²å­˜åº«ä¸­æ²’æœ‰å…¶ä»–æª”æ¡ˆã€‚</p>';
                    return;
                }
                
                // æŒ‰é¡å‹æ’åºï¼šè³‡æ–™å¤¾åœ¨å‰ï¼Œæª”æ¡ˆåœ¨å¾Œ
                files.sort((a, b) => {
                    if (a.type === 'dir' && b.type !== 'dir') return -1;
                    if (a.type !== 'dir' && b.type === 'dir') return 1;
                    return a.name.localeCompare(b.name);
                });
                
                let html = '<ul class="file-list" id="file-list">';
                
                files.forEach(file => {
                    const isDirectory = file.type === 'dir';
                    const icon = isDirectory ? 'ğŸ“' : getFileIcon(file.name);
                    const fileUrl = file.html_url ? file.html_url.replace('github.com', 'raw.githubusercontent.com').replace('/blob/', '/') : file.name;
                    
                    html += `
                    <li class="file-item">
                        <span class="file-icon">${icon}</span>
                        <a href="${isDirectory ? file.html_url : file.name}" class="file-link" 
                           target="${isDirectory ? '_blank' : '_self'}" 
                           data-filename="${file.name.toLowerCase()}">
                           ${file.name}
                           <span class="file-meta">${formatSize(file.size)}</span>
                        </a>
                    </li>`;
                });
                
                html += '</ul>';
                fileContainer.innerHTML = html;
                
                // æ·»åŠ æœå°‹åŠŸèƒ½
                setupSearch();
            }
            
            // è¨­ç½®æœå°‹åŠŸèƒ½
            function setupSearch() {
                const searchInput = document.getElementById('search');
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const fileItems = document.querySelectorAll('#file-list .file-item');
                    
                    fileItems.forEach(item => {
                        const fileName = item.querySelector('.file-link').getAttribute('data-filename');
                        if (fileName.includes(searchTerm)) {
                            item.style.display = '';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }
            
            // å¦‚æœç„¡æ³•å¾GitHub APIç²å–ï¼Œé¡¯ç¤ºæ›¿ä»£å…§å®¹
            function displayAlternative() {
                const fileContainer = document.getElementById('file-container');
                
                // æ‰‹å‹•æ·»åŠ ä¸€äº›å¯èƒ½çš„HTMLæª”æ¡ˆï¼Œé€šå¸¸é©åˆGitHub Pages
                const commonFiles = [
                    { name: 'mypage.html', icon: 'ğŸ“„', description: 'HTMLæª”æ¡ˆ' },
                    { name: 'aboutme.html', icon: 'ğŸ“„', description: 'HTMLæª”æ¡ˆ' },
                    { name: 'contact.html', icon: 'ğŸ“„', description: 'HTMLæª”æ¡ˆ' },
                    { name: 'portfolio.html', icon: 'ğŸ“„', description: 'HTMLæª”æ¡ˆ' },
                    { name: 'style.css', icon: 'ğŸ¨', description: 'CSSæ¨£å¼è¡¨' },
                    { name: 'script.js', icon: 'ğŸ“œ', description: 'JavaScriptæª”æ¡ˆ' }
                ];
                
                let html = `
                <div class="error">
                    <p>ç„¡æ³•è‡ªå‹•ç²å–å„²å­˜åº«æª”æ¡ˆåˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ‚¨å¯èƒ½æœ‰çš„å¸¸è¦‹æª”æ¡ˆï¼š</p>
                </div>
                <ul class="file-list" id="file-list">`;
                
                commonFiles.forEach(file => {
                    html += `
                    <li class="file-item">
                        <span class="file-icon">${file.icon}</span>
                        <a href="${file.name}" class="file-link" data-filename="${file.name.toLowerCase()}">
                            ${file.name}
                            <span class="file-meta">${file.description}</span>
                        </a>
                    </li>`;
                });
                
                html += `</ul>
                <p style="margin-top: 15px;">
                    å¦‚æœä¸Šè¿°æª”æ¡ˆä¸å­˜åœ¨ï¼Œå®ƒå€‘çš„é€£çµå°‡ç„¡æ³•å·¥ä½œã€‚è«‹ä½¿ç”¨å¯¦éš›å­˜åœ¨æ–¼åŒä¸€ç›®éŒ„ä¸­çš„æª”åæ›¿æ›é€™äº›é€£çµã€‚
                </p>`;
                
                fileContainer.innerHTML = html;
                
                // åŒæ¨£æ·»åŠ æœå°‹åŠŸèƒ½
                setupSearch();
            }
            
            // å¦‚æœæ˜¯å¾æœ¬åœ°æª”æ¡ˆç³»çµ±é–‹å•Ÿï¼Œé¡¯ç¤ºè­¦å‘Š
            function displayLocalFileWarning() {
                const fileContainer = document.getElementById('file-container');
                
                fileContainer.innerHTML = `
                <div class="error">
                    <p>æ‚¨ä¼¼ä¹æ­£åœ¨æœ¬åœ°æª”æ¡ˆç³»çµ±ä¸­æŸ¥çœ‹æ­¤é é¢ã€‚è¦ä½¿æ­¤é é¢æ­£å¸¸å·¥ä½œï¼Œè«‹ï¼š</p>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>å°‡æ­¤é é¢ä¸Šå‚³åˆ°æ‚¨çš„GitHubå„²å­˜åº«</li>
                        <li>é€éGitHub Pagesè¨ªå•æ­¤é é¢</li>
                    </ol>
                </div>
                <p style="margin-top: 15px;">
                    æ‰‹å‹•æ·»åŠ æ‚¨çš„æª”æ¡ˆé€£çµï¼Œæˆ–åœ¨æœ¬åœ°ä½¿ç”¨ä¼ºæœå™¨ä¾†æ¸¬è©¦æ­¤é é¢ã€‚
                </p>`;
            }
            
            // ä¾æª”æ¡ˆé¡å‹ç²å–åœ–ç¤º
            function getFileIcon(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                const icons = {
                    'html': 'ğŸ“„',
                    'htm': 'ğŸ“„',
                    'css': 'ğŸ¨',
                    'js': 'ğŸ“œ',
                    'json': 'ğŸ“‹',
                    'txt': 'ğŸ“',
                    'md': 'ğŸ“‹',
                    'jpg': 'ğŸ–¼ï¸',
                    'jpeg': 'ğŸ–¼ï¸',
                    'png': 'ğŸ–¼ï¸',
                    'gif': 'ğŸ–¼ï¸',
                    'svg': 'ğŸ–¼ï¸',
                    'pdf': 'ğŸ“‘',
                    'zip': 'ğŸ“¦',
                    'gz': 'ğŸ“¦',
                    'tar': 'ğŸ“¦'
                };
                
                return icons[ext] || 'ğŸ“„';
            }
            
            // æ ¼å¼åŒ–æª”æ¡ˆå¤§å°
            function formatSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                if (!bytes || isNaN(bytes)) return '';
                
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(1024));
                return parseFloat((bytes / Math.pow(1024, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // åˆå§‹åŒ–
            fetchRepoContents();
        });
    </script>
</body>
</html>
